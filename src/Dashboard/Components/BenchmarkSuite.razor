<div id="@(Name)" class="benchmark-set">
    <h2 class="benchmark-title">
        @(Name)
        <a class="benchmark-set-anchor" href="#@(Name)">
            <Icon Name="@(Icons.Link)" />
        </a>
    </h2>
    <div class="benchmark-graphs row row-cols-1 row-cols-sm-2">
        @foreach ((var benchmark, var items) in _items)
        {
            <BenchmarkHistory Items="@(items)" Name="@(benchmark)" Suite="@(Name)" />
        }
    </div>
</div>

@code {
    private readonly Dictionary<string, IList<BenchmarkItem>> _items = new();

    /// <summary>
    /// Gets the benchmark suite name.
    /// </summary>
    [Parameter]
    public required string Name { get; init; }

    /// <summary>
    /// Gets the benchmark runs.
    /// </summary>
    [Parameter]
    public required IList<BenchmarkRun> Runs { get; init; }

    protected override void OnInitialized()
    {
        Dictionary<string, SortedList<DateTimeOffset, BenchmarkItem>> sets = new();

        foreach (var run in Runs)
        {
            foreach (var benchmark in run.Benchmarks)
            {
                if (!sets.TryGetValue(benchmark.Name, out var results))
                {
                    sets[benchmark.Name] = results = [];
                }

                results.Add(run.Timestamp, new(run.Commit, benchmark));
            }
        }

        foreach ((var suite, var results) in sets)
        {
            _items[suite] = results.Select((p) => p.Value).ToList();
        }
    }
}
